# Plan: Fix Cursor Not Visible in Preview

## Problem Summary

The cursor is not visible in the editor preview after recording because:

1. **Animation loop only runs during playback**: The cursor position update logic in `EditorView.tsx` (lines 139-148) only executes when `isPlaying` is `true`
2. **No initial cursor position**: When the recording loads, `cursorPosition` state starts as `null` and is never set until playback begins
3. **CursorOverlay returns null**: When `position` is `null`, the overlay component returns nothing (line 80 of `CursorOverlay.tsx`)

## Solution Overview

Update cursor position in three scenarios:

1. **On recording load** - Show cursor at initial position (time 0)
2. **On seek while paused** - Update cursor when timeline position changes
3. **During playback** - Continue using existing animation loop (already works)

## Files to Modify

| File                                   | Purpose                                                 |
| -------------------------------------- | ------------------------------------------------------- |
| `src/components/editor/EditorView.tsx` | Add initial cursor position and seek-while-paused logic |

## Implementation Details

### Change 1: Import `findCursorAtTimeInterpolated`

**Location**: Line 22-24 in `EditorView.tsx`

Add `findCursorAtTimeInterpolated` to the imports from `recordingPlayback.ts`. This function is better than `findCursorAtTime` because it returns the first cursor event when time is before all events.

```typescript
import {
  findCursorAtTime,
  findCursorAtTimeInterpolated, // ADD THIS
  findRecentClicks,
} from "../../utils/recordingPlayback";
```

### Change 2: Add helper function to update cursor position

**Location**: After the `previewSize` state (around line 65), add:

```typescript
// Helper to update cursor position at a specific time (used for initial load and seeking while paused)
const updateCursorForTime = useCallback(
  (timeMs: number, resetSmoother: boolean = false) => {
    if (!recordingBundle?.mouseMoves?.length) {
      return;
    }

    const cursorAtTime = findCursorAtTimeInterpolated(
      recordingBundle.mouseMoves,
      timeMs,
    );

    if (cursorAtTime) {
      if (resetSmoother && smootherRef.current) {
        smootherRef.current.reset(cursorAtTime.x, cursorAtTime.y);
      }

      if (smootherRef.current && smoothingEnabled) {
        const newPosition = smootherRef.current.update(
          {
            x: cursorAtTime.x,
            y: cursorAtTime.y,
            cursorId: cursorAtTime.cursorId,
            processTimeMs: timeMs,
          },
          0, // No delta time for instant update
        );
        setCursorPosition(newPosition);
      } else {
        setCursorPosition({
          x: cursorAtTime.x,
          y: cursorAtTime.y,
          rawX: cursorAtTime.x,
          rawY: cursorAtTime.y,
          cursorId: cursorAtTime.cursorId,
        });
      }
    }
  },
  [recordingBundle?.mouseMoves, smoothingEnabled],
);
```

### Change 3: Set initial cursor position when recording loads

**Location**: After the recording bundle load effect (after line 124), add new effect:

```typescript
// Set initial cursor position when recording bundle loads
useEffect(() => {
  if (!recordingBundle?.mouseMoves?.length) {
    return;
  }

  // Get the initial cursor position at time 0
  updateCursorForTime(0, true);
}, [recordingBundle, updateCursorForTime]);
```

### Change 4: Update cursor on seek while paused

**Location**: After the new initial cursor effect, add:

```typescript
// Update cursor position when seeking while paused
useEffect(() => {
  // Only run when paused - animation loop handles playback
  if (isPlaying) {
    return;
  }

  if (!recordingBundle?.mouseMoves?.length) {
    return;
  }

  updateCursorForTime(currentTime, true);
}, [currentTime, isPlaying, recordingBundle?.mouseMoves, updateCursorForTime]);
```

### Change 5: Fix existing seek handler (optional enhancement)

The existing `handleTimelineClick` already resets the smoother on seek (lines 279-287), but now it will also trigger the new seek-while-paused effect for cursor position update.

## Edge Cases Handled

1. **No mouse moves data**: Guards check `recordingBundle?.mouseMoves?.length`
2. **Cursor events start after time 0**: `findCursorAtTimeInterpolated` returns the first event
3. **Empty recording bundle**: Null-safe access with optional chaining
4. **CursorSmoother not initialized**: Checked before calling methods
5. **Transition between play/pause**: Effects properly handle state changes

## Verification Steps

After implementing, test the following:

1. **Initial load**: Load a recording - cursor should appear immediately at initial position
2. **Seek while paused**: With video paused, click on timeline - cursor should update
3. **Playback**: Play video - cursor should animate smoothly
4. **Pause mid-playback**: Pause video - cursor should stay at current position
5. **Seek after pause**: While paused, seek to different time - cursor should jump correctly
6. **Resume after seek**: Resume playback - cursor should continue smoothly

## Testing Commands

```bash
# Build frontend to check for TypeScript errors
bun run build

# Run full Tauri dev to test in app
bun run tauri:dev
```

Then:

1. Start a recording
2. Stop the recording
3. Observe if cursor appears in the editor preview
4. Test seeking and playback
